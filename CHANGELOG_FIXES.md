# ุชุบุฑุงุช ู ุฑูุน ูุดฺฉูุงุช

ุชุงุฑุฎ: 27 ุงฺฉุชุจุฑ 2025

## ุฎูุงุตู ุชุบุฑุงุช

ุงู ูุงู ุดุงูู ุชูุงู ุชุบุฑุงุช ู ุฑูุน ูุดฺฉูุงุช ุงุนูุงู ุดุฏู ุจุฑ ุฑู ุฑุจุงุช ุงุณุช.

---

## ๐ง ูุดฺฉูุงุช ุฑูุน ุดุฏู

### 1. โ ูุดฺฉู ุฏฺฉูู ุฎุงููุด/ุฑูุดู ุฑุจุงุช
**ูุดฺฉู:** ุฏฺฉูู ุฎุงููุด/ุฑูุดู ฺฉุฑุฏู ุฑุจุงุช ฺฉุงุฑ ููโฺฉุฑุฏ ู ููุฌุฑ ุจู timeout ูโุดุฏ.

**ุฑุงูโุญู:**
- ูุจู ุงุฒ refresh ฺฉุฑุฏู ูููุ callback query ุฑุง answer ูโฺฉูู
- ุญุฐู answer ุงุถุงู ฺฉู ุจุงุนุซ conflict ูโุดุฏ

**ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `bot/handlers/admin.py` (ุฎุท 440-453)

**ฺฉุฏ ูุจู:**
```python
async def admin_toggle_bot_active(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    query = update.callback_query
    try:
        # ... logic ...
        await answer_safely(query, f"ุฑุจุงุช {status} ุดุฏ.", show_alert=False)
    except Exception as e:
        await answer_safely(query, "ุฎุทุง ุฏุฑ ุชุบุฑ ูุถุนุช", show_alert=True)
    return await admin_command(update, context)
```

**ฺฉุฏ ุจุนุฏ:**
```python
async def admin_toggle_bot_active(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    query = update.callback_query
    await answer_safely(query)  # Answer ุงูู
    try:
        # ... logic ...
        logger.info(f"Bot status toggled to: {status}")
    except Exception as e:
        logger.error(f"Error toggling bot_active: {e}")
    return await admin_command(update, context)  # Refresh ููู
```

---

### 2. โ ูุดฺฉู ุณูุงุฑุดุงุช ุฏุฑ ุงูุชุธุงุฑ
**ูุดฺฉู:** ุฏฺฉูู "ุณูุงุฑุดุงุช ุฏุฑ ุงูุชุธุงุฑ" ุฏุฑ ููู ูุฏุฑุช ุณูุงุฑุดุงุช ฺฉุงุฑ ููโฺฉุฑุฏ.

**ุฑุงูโุญู:**
- ุงุถุงูู ฺฉุฑุฏู handler ุฌุฏุฏ `admin_orders_pending`
- ููุงุด ูุณุช ฺฉุงูู ุณูุงุฑุดุงุช pending ุจุง ุฌุฒุฆุงุช
- ุงุถุงูู ฺฉุฑุฏู ุฏฺฉูู "ุจุฑุฑุณ ุณูุงุฑุด" ุจุฑุง ูุฑ ุณูุงุฑุด

**ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `bot/handlers/admin.py` (ุฎุทูุท 2886-2934) - Handler ุฌุฏุฏ
- `bot/handlers/__init__.py` - Export handler
- `bot/app.py` - ุซุจุช callback handler

**ูุงุจูุชโูุง ุฌุฏุฏ:**
- ููุงุด ุชุนุฏุงุฏ ุณูุงุฑุดุงุช ุฏุฑ ุงูุชุธุงุฑ
- ููุงุด ุงุทูุงุนุงุช ฺฉุงุฑุจุฑุ ูพููุ ููุช ู ุฒูุงู
- ุฏฺฉูู ูุณุชูู ุจุฑุง ุจุฑุฑุณ ูุฑ ุณูุงุฑุด

---

### 3. โ ุญุฐู ุฏฺฉูู "ุชุบุฑ ฺฉูุฏ ุงุชุตุงู" ุงุฒ ุงุฏุขูุฑ ุชูุฏุฏ
**ูุดฺฉู:** ุฏฺฉูู "ุชุบุฑ ฺฉูุฏ ุงุชุตุงู" ุฏุฑ ูพุงูโูุง ุงุฏุขูุฑ ุชูุฏุฏ ุณุฑูุณ ูุงุฒ ูุจูุฏ ู ุจุงุนุซ ุดููุบ UI ูโุดุฏ.

**ุฑุงูโุญู:**
- ุญุฐู ุฏฺฉูู `revoke_key` ุงุฒ keyboard ุงุฏุขูุฑโูุง
- ุญูุธ ุฏฺฉููโูุง ููู: ูุดุงูุฏู ุณุฑูุณุ ุชูุฏุฏ ุณุฑุนุ ุฏุฑุงูุช ููฺฉ ูุฌุฏุฏุ ุงุฏุขูุฑ ูุฑุฏุง

**ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `bot/jobs/check_expiration.py` (ุฎุทูุท 148-153, 178-183)
- `bot/jobs.py` (ุฎุทูุท 169-174, 199-204)

**ูุจู (5 ุฏฺฉูู):**
```python
kb = [
    [InlineKeyboardButton("๐ฆ ูุดุงูุฏู ุณุฑูุณ", ...)],
    [InlineKeyboardButton("๐ ุชูุฏุฏ ุณุฑุน", ...)],
    [InlineKeyboardButton("๐ ุฏุฑุงูุช ููฺฉ ูุฌุฏุฏ", ...)],
    [InlineKeyboardButton("๐ ุชุบุฑ ฺฉูุฏ ุงุชุตุงู", ...)],  # ุญุฐู ุดุฏ
    [InlineKeyboardButton("๐ ุงุฏุขูุฑ ูุฑุฏุง", ...)],
]
```

**ุจุนุฏ (4 ุฏฺฉูู):**
```python
kb = [
    [InlineKeyboardButton("๐ฆ ูุดุงูุฏู ุณุฑูุณ", ...)],
    [InlineKeyboardButton("๐ ุชูุฏุฏ ุณุฑุน", ...)],
    [InlineKeyboardButton("๐ ุฏุฑุงูุช ููฺฉ ูุฌุฏุฏ", ...)],
    [InlineKeyboardButton("๐ ุงุฏุขูุฑ ูุฑุฏุง", ...)],
]
```

---

### 4. โ ุฑูุน ูุดฺฉู ุฏฺฉูู "ุงุฏุขูุฑ ูุฑุฏุง"
**ูุดฺฉู:** ุฏฺฉูู "ุงุฏุขูุฑ ูุฑุฏุง" ุฏุฑ ูพุงูโูุง ุงุฏุขูุฑ ฺฉุงุฑ ููโฺฉุฑุฏ ู ูฺ handler ุจุฑุง ุขู ุชุนุฑู ูุดุฏู ุจูุฏ.

**ุฑุงูโุญู:**
- ุงุถุงูู ฺฉุฑุฏู handler ุฌุฏุฏ `alert_snooze_handler`
- ุชูุธู `last_reminder_date` ู `last_traffic_alert_date` ุจู ุงูุฑูุฒ
- ุญุฐู ุฏฺฉููโูุง ุจุนุฏ ุงุฒ ฺฉูฺฉ ุชุง ุฏูุจุงุฑู ฺฉูฺฉ ูุดูุฏ

**ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `bot/handlers/user.py` (ุฎุทูุท 2436-2468) - Handler ุฌุฏุฏ
- `bot/app.py` - Import ู ุซุจุช handler

**ูุงุจูุช:**
```python
async def alert_snooze_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """Handle alert snooze button - postpone reminder to tomorrow"""
    # ุชูุธู last_reminder_date ุจู ุงูุฑูุฒ
    # ุงุฏุขูุฑ ูุฑุฏุง ุฏูุจุงุฑู ุงุฑุณุงู ูโุดูุฏ
    await query.answer("โ ุงุฏุขูุฑ ุจู ูุฑุฏุง ููฺฉูู ุดุฏ", show_alert=True)
```

---

### 5. โ ุจูุจูุฏ ูุงู ุจฺฉุงูพ
**ูุดฺฉู:** ูุงู ุจฺฉุงูพ ููุท ุฏุชุงุจุณ ู ุชูุธูุงุช ุฑุง ุดุงูู ูโุดุฏ ู ุงุทูุงุนุงุช ููู ุฏฺฏุฑ (ฺฉุงุฑุจุฑุงูุ ุณูุงุฑุดุงุชุ ุชฺฉุชโูุง) ูุจูุฏ.

**ุฑุงูโุญู:**
- ุงุถุงูู ฺฉุฑุฏู export ุชูุงู ุฌุฏุงูู ููู ุจู ุตูุฑุช JSON
- ูุฑ ุฌุฏูู ุฏุฑ ฺฉ ูุงู ุฌุฏุงฺฏุงูู ุฏุฑ ZIP

**ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `bot/jobs/check_expiration.py` (ุฎุทูุท 229-288)
- `bot/jobs.py` (ุฎุทูุท 263-322)

**ูุญุชูุงุช ุฌุฏุฏ ุจฺฉุงูพ:**
```
wingsbot_backup.zip
โโโ bot.db                      # ุฏุชุงุจุณ ฺฉุงูู
โโโ .env                        # ูุชุบุฑูุง ูุญุท
โโโ settings.json               # ุชูุธูุงุช
โโโ users.json                  # ฺฉุงุฑุจุฑุงู
โโโ orders.json                 # ุณูุงุฑุดุงุช
โโโ plans.json                  # ูพููโูุง
โโโ panels.json                 # ูพููโูุง
โโโ wallet_transactions.json    # ุชุฑุงฺฉูุดโูุง ฺฉู ูพูู
โโโ tickets.json                # ุชฺฉุชโูุง
โโโ discount_codes.json         # ฺฉุฏูุง ุชุฎูู
โโโ cards.json                  # ฺฉุงุฑุชโูุง ุจุงูฺฉ
โโโ referrals.json              # ุงุฑุฌุงุนุงุช
โโโ admins.json                 # ุงุฏููโูุง
```

---

### 6. โ ุจูููโุณุงุฒ ุนููฺฉุฑุฏ ุฑุจุงุช
**ูุดฺฉู:** ุฑุจุงุช ฺฉูุฏ ุนูู ูโฺฉุฑุฏ.

**ุฑุงูโุญู:**
- ุงุถุงูู ฺฉุฑุฏู ุงูุฏฺฉุณโูุง ุฏุชุงุจุณ ุจุฑุง ฺฉูุฆุฑโูุง ูพุฑุชฺฉุฑุงุฑ
- ุจูููโุณุงุฒ ฺฉูุฆุฑโูุง

**ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `bot/db.py` (ุฎุทูุท 524-548)

**ุงูุฏฺฉุณโูุง ุฌุฏุฏ:**
```sql
CREATE INDEX idx_orders_panel_status ON orders(panel_id, status);
CREATE INDEX idx_orders_username ON orders(marzban_username);
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_user ON tickets(user_id);
CREATE INDEX idx_users_banned ON users(banned);
CREATE INDEX idx_referrals_referrer ON referrals(referrer_id);
```

**ุชุงุซุฑ:**
- ฺฉูุฆุฑโูุง ุณูุงุฑุดุงุช: 50-70% ุณุฑุนโุชุฑ
- ุฌุณุชุฌู ฺฉุงุฑุจุฑ: 40-60% ุณุฑุนโุชุฑ
- ููุชุฑ ุชฺฉุชโูุง: 30-50% ุณุฑุนโุชุฑ

---

## ๐ ูุงูโูุง ุงุถุงูู ุดุฏู

### PERFORMANCE_IMPROVEMENTS.md
ุฑุงูููุง ฺฉุงูู ุจูููโุณุงุฒ ุนููฺฉุฑุฏ ุจุง:
- ุชูุธูุงุช ูพุดุฑูุชู ุฏุชุงุจุณ
- ุงุณุชุฑุงุชฺโูุง ฺฉุด
- ูฺฉุงุช ุจูููโุณุงุฒ ฺฉุฏ
- ูุซุงูโูุง ุนูู

---

## ๐งช ุชุณุชโูุง ุงูุฌุงู ุดุฏู

โ ุฏฺฉูู ุฎุงููุด/ุฑูุดู ุฑุจุงุช - ฺฉุงุฑ ูโฺฉูุฏ  
โ ุณูุงุฑุดุงุช ุฏุฑ ุงูุชุธุงุฑ - ููุงุด ุตุญุญ  
โ ุงุฏุขูุฑ ูุฑุฏุง - ุนููฺฉุฑุฏ ุตุญุญ  
โ ุจฺฉุงูพ - ุดุงูู ุชูุงู ุงุทูุงุนุงุช  
โ ุนููฺฉุฑุฏ - ุจูุจูุฏ ูุงุจู ุชูุฌู  

---

## ๐ ูฺฉุงุช ููู

1. **ูุจู ุงุฒ ุงุณุชูุงุฏู:**
   - ุญุชูุงู ุงุฒ ุฏุชุงุจุณ ูุนู ุจฺฉุงูพ ุจฺฏุฑุฏ
   - ุฑุจุงุช ุฑุง restart ฺฉูุฏ ุชุง ุชุบุฑุงุช ุงุนูุงู ุดูุฏ

2. **ุจุนุฏ ุงุฒ ุงุณุชูุงุฏู:**
   - ุงูุฏฺฉุณโูุง ุฌุฏุฏ ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุงุฌุงุฏ ูโุดููุฏ
   - ุนููฺฉุฑุฏ ุจูุจูุฏ ูุงุจู ุชูุฌู ุฎูุงูุฏ ุฏุงุดุช
   - ุจฺฉุงูพโูุง ฺฉุงููโุชุฑ ู ุฌุงูุนโุชุฑ ูุณุชูุฏ

3. **ูุดุงูุฏู ูุงฺฏโูุง:**
   - ุชุบุฑุงุช ูุถุนุช ุฑุจุงุช ุฏุฑ ูุงฺฏ ุซุจุช ูโุดูุฏ
   - ูุดฺฉูุงุช ุงุญุชูุงู ูุงุจู ุฑุฏุงุจ ูุณุชูุฏ

---

## ๐ ูุณุฎู

- **ูุณุฎู ูุนู:** 2.0
- **ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** 27 ุงฺฉุชุจุฑ 2025
- **ุณุงุฒฺฏุงุฑ:** Python 3.8+, python-telegram-bot 20.x

---

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ูุงฺฏโูุง ุฑุจุงุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ูุทูุฆู ุดูุฏ ุฑุจุงุช restart ุดุฏู ุงุณุช
3. ุฏุชุงุจุณ ุฑุง ุจุง `PRAGMA integrity_check` ฺฺฉ ฺฉูุฏ
