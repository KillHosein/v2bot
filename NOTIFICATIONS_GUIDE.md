# 📢 راهنمای تنظیمات اعلان‌ها و هشدارها

## 🎯 امکانات اعلان‌ها

ربات دارای سیستم پیشرفته اعلان‌های خودکار برای کاربران است که می‌توانید از پنل ادمین مدیریت کنید.

---

## ⚙️ تنظیمات موجود

### 1️⃣ **هشدار حجم (Traffic Alert)**
- **توضیح:** وقتی حجم باقی‌مانده سرویس کاربر به زیر مقدار مشخص شده برسد، پیام هشدار ارسال می‌شود
- **تنظیمات:**
  - ✅/❌ فعال/غیرفعال کردن
  - 📊 تنظیم مقدار (مثلاً 5 گیگابایت)
- **مثال:** اگر 5GB تنظیم کنید، وقتی حجم باقی‌مانده کمتر از 5 گیگ شد، کاربر اعلان می‌گیرد

### 2️⃣ **هشدار زمانی (Time Alert)**
- **توضیح:** وقتی تعداد روزهای باقی‌مانده تا پایان سرویس به زیر مقدار مشخص شده برسد، پیام هشدار ارسال می‌شود
- **تنظیمات:**
  - ✅/❌ فعال/غیرفعال کردن
  - ⏰ تنظیم تعداد روزها (مثلاً 3 روز)
- **مثال:** اگر 3 روز تنظیم کنید، سه روز قبل از پایان سرویس، کاربر اعلان می‌گیرد

### 3️⃣ **نمایش حجم سرویس**
- **توضیح:** نمایش یا عدم نمایش اطلاعات حجم مصرفی برای کاربر
- **تنظیمات:** ✅/❌ فعال/غیرفعال

### 4️⃣ **بکاپ خودکار**
- **توضیح:** ارسال خودکار فایل پشتیبان از دیتابیس و تنظیمات به ادمین‌ها
- **تنظیمات:**
  - ✅/❌ فعال/غیرفعال کردن
  - ⏱️ بازه زمانی (مثلاً هر 12 ساعت)

---

## 🔧 نحوه استفاده

### از طریق پنل ادمین:

1. وارد بات تلگرام شوید
2. به **تنظیمات** بروید
3. در بخش **"📊 تنظیمات اعلان‌ها و هشدارها"** گزینه‌های زیر را خواهید دید:

#### 🔔 اجرای دستی هشدارها (تست)
- برای تست فوری سیستم اعلان‌ها
- همه سرویس‌ها را بررسی می‌کند و هشدارهای لازم را ارسال می‌کند
- **مناسب برای:** تست اولیه، بررسی عملکرد، اطلاع‌رسانی فوری

#### ✅/❌ فعال/غیرفعال کردن هر نوع هشدار
- با یک کلیک می‌توانید هر هشدار را فعال یا غیرفعال کنید

#### 📊 تنظیم مقادیر
- **مقدار هشدار (GB):** برای تنظیم حجم باقی‌مانده
- **روزهای هشدار زمان:** برای تنظیم تعداد روزهای باقی‌مانده

---

## 💡 نکات مهم

### ⚡ اجرای خودکار
- هشدارها به طور خودکار **روزانه** اجرا می‌شوند
- ساعت اجرا از تنظیمات قابل تغییر است
- برای جلوگیری از ارسال پیام‌های تکراری، هر کاربر حداکثر **یک بار در روز** اعلان دریافت می‌کند

### 🎯 منطق هوشمند
- اگر هم هشدار حجم و هم هشدار زمانی فعال باشند، ربات ابتدا هشدار زمانی را چک می‌کند
- برای سرویس‌های Trial (کمتر از 3 روز)، پس از انقضا بلافاصله حذف می‌شوند
- برای سرویس‌های عادی، 2 روز پس از انقضا حذف می‌شوند

### 📝 متن پیام‌ها
- متن پیام‌های هشدار از دیتابیس خوانده می‌شود (message_name: `renewal_reminder_text`)
- می‌توانید متن را سفارشی‌سازی کنید
- دکمه‌های inline برای اقدامات سریع (تمدید، مشاهده، تغییر کلید) به صورت خودکار اضافه می‌شوند

---

## 🛠️ تنظیمات پیشرفته

### از طریق دیتابیس (SQLite):

```bash
cd /root/v2bot
sqlite3 data/wingsbot.db

# فعال کردن هشدار حجم
UPDATE settings SET value='1' WHERE key='traffic_alert_enabled';

# تنظیم مقدار به 10 گیگابایت
UPDATE settings SET value='10' WHERE key='traffic_alert_value_gb';

# فعال کردن هشدار زمانی
UPDATE settings SET value='1' WHERE key='time_alert_enabled';

# تنظیم هشدار زمانی به 5 روز
UPDATE settings SET value='5' WHERE key='time_alert_days';

# خروج
.exit
```

---

## 🐛 عیب‌یابی

### هشدارها ارسال نمی‌شوند؟

1. **بررسی فعال بودن:**
   ```bash
   sqlite3 data/wingsbot.db "SELECT key, value FROM settings WHERE key LIKE '%alert%';"
   ```

2. **بررسی لاگ‌ها:**
   ```bash
   sudo journalctl -u wingsbot -f --no-pager | grep -i "alert\|reminder"
   ```

3. **اجرای دستی برای تست:**
   - از پنل ادمین > تنظیمات > 🔔 اجرای دستی هشدارها

4. **بررسی متن پیام:**
   ```bash
   sqlite3 data/wingsbot.db "SELECT * FROM messages WHERE message_name='renewal_reminder_text';"
   ```

---

## 📚 مثال‌های کاربردی

### سناریو 1: فروشگاه VPN با پشتیبانی 24/7
```
- هشدار حجم: 5 GB (فعال)
- هشدار زمانی: 2 روز (فعال)
```
کاربران 2 روز قبل از اتمام و وقتی کمتر از 5 گیگ حجم دارند، مطلع می‌شوند.

### سناریو 2: سرویس Trial محور
```
- هشدار حجم: 1 GB (فعال)
- هشدار زمانی: 1 روز (فعال)
```
کاربران Trial یک روز قبل و با یک گیگ باقی‌مانده اعلان می‌گیرند.

### سناریو 3: فروش عمده به نمایندگان
```
- هشدار حجم: 20 GB (فعال)
- هشدار زمانی: 7 روز (فعال)
```
نمایندگان یک هفته قبل و با 20 گیگ باقی‌مانده اعلان می‌گیرند.

---

## 🚀 به‌روزرسانی‌های آینده

- [ ] اعلان‌های سفارشی برای هر پلن
- [ ] ارسال اعلان به تلگرام/ایمیل/SMS
- [ ] تنظیم چندین آستانه برای هر نوع هشدار
- [ ] گزارش آماری از اعلان‌های ارسال شده

---

## 📞 پشتیبانی

اگر مشکلی داشتید یا پیشنهادی دارید:
- GitHub Issues: https://github.com/KillHosein/v2bot/issues
- توسعه‌دهنده: @YourTelegramUsername

---

**نسخه:** 2.0.0  
**آخرین به‌روزرسانی:** اکتبر 2025
