# Wings Bot - ุฑุงูููุง ูุตุจ ู ุงุนูุงู ุชุบุฑุงุช

ุงู ุฑุงูููุง ุจุฑุง ุงุนูุงู ุชุบุฑุงุช ู ุฑูุน ูุดฺฉูุงุช ุฌุฏุฏ Wings Bot ุงุณุช.

## ๐ ููุฑุณุช ูุทุงูุจ
1. [ูพุดโูุงุฒูุง](#ูพุด-ูุงุฒูุง)
2. [ูุญูู ุงุนูุงู ุชุบุฑุงุช](#ูุญูู-ุงุนูุงู-ุชุบุฑุงุช)
3. [ุชุณุช ุนููฺฉุฑุฏ](#ุชุณุช-ุนููฺฉุฑุฏ)
4. [ุฑูุน ูุดฺฉูุงุช ุงุญุชูุงู](#ุฑูุน-ูุดฺฉูุงุช-ุงุญุชูุงู)

---

## ูพุดโูุงุฒูุง

โ Python 3.8 ุง ุจุงูุงุชุฑ  
โ python-telegram-bot 20.x  
โ ุฏุณุชุฑุณ ุจู ุณุฑูุฑ ู ูุงูโูุง ุฑุจุงุช  
โ ุจฺฉุงูพ ุงุฒ ุฏุชุงุจุณ ูุนู  

---

## ูุญูู ุงุนูุงู ุชุบุฑุงุช

### ุฑูุด 1: ุงุนูุงู ุฎูุฏฺฉุงุฑ (ุชูุตู ูโุดูุฏ)

#### ูุฑุญูู 1: ูุชููู ฺฉุฑุฏู ุฑุจุงุช
```bash
# ุงฺฏุฑ ุจุง systemd ุงุฌุฑุง ูโฺฉูุฏ:
sudo systemctl stop v2bot

# ุงฺฏุฑ ุจุง screen ุงุฌุฑุง ูโฺฉูุฏ:
screen -r v2bot
# ุณูพุณ Ctrl+C ุจุฑุง ูุชููู ฺฉุฑุฏู
```

#### ูุฑุญูู 2: ุจฺฉุงูพ ฺฏุฑ
```bash
cd /path/to/v2bot-master

# ุจฺฉุงูพ ุฏุณุช ุฏุชุงุจุณ
cp bot.db bot.db.backup_$(date +%Y%m%d)

# ุจฺฉุงูพ ฺฉู ูพุฑูฺู (ุงุฎุชุงุฑ)
cd ..
tar -czf v2bot-backup-$(date +%Y%m%d).tar.gz v2bot-master/
```

#### ูุฑุญูู 3: ุงุฌุฑุง ุงุณฺฉุฑูพุช ุจูููโุณุงุฒ
```bash
cd /path/to/v2bot-master

# ุงุนุทุง ูุฌูุฒ ุงุฌุฑุง
chmod +x apply_performance_fixes.py

# ุงุฌุฑุง ุงุณฺฉุฑูพุช
python3 apply_performance_fixes.py
```

ุงุณฺฉุฑูพุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
- ุจฺฉุงูพ ุงุฒ ุฏุชุงุจุณ ูโฺฏุฑุฏ
- ุงูุฏฺฉุณโูุง ุฌุฏุฏ ุฑุง ุงุถุงูู ูโฺฉูุฏ
- ุฏุชุงุจุณ ุฑุง ุจูููโุณุงุฒ ูโฺฉูุฏ
- ฺฏุฒุงุฑุด ููุง ููุงุด ูโุฏูุฏ

#### ูุฑุญูู 4: ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ ุฑุจุงุช
```bash
# ุงฺฏุฑ ุจุง systemd:
sudo systemctl start v2bot
sudo systemctl status v2bot

# ุงฺฏุฑ ุจุง screen:
screen -S v2bot
cd /path/to/v2bot-master
python3 main.py
# ุณูพุณ Ctrl+A+D ุจุฑุง detach
```

---

### ุฑูุด 2: ุงุนูุงู ุฏุณุช

ุงฺฏุฑ ุชุฑุฌุญ ูโุฏูุฏ ุชุบุฑุงุช ุฑุง ุฏุณุช ุงุนูุงู ฺฉูุฏ:

#### 1. ุจุฑูุฒุฑุณุงู ูุงูโูุง

ูุงูโูุง ฺฉู ุชุบุฑ ฺฉุฑุฏูโุงูุฏ:
```
bot/handlers/admin.py
bot/handlers/__init__.py
bot/handlers/user.py
bot/app.py
bot/db.py
bot/jobs/check_expiration.py
bot/jobs.py
```

#### 2. ุงุฌุฑุง SQL ุจุฑุง ุงูุฏฺฉุณโูุง

```bash
sqlite3 bot.db
```

```sql
-- ุงุถุงูู ฺฉุฑุฏู ุงูุฏฺฉุณโูุง ุฌุฏุฏ
CREATE INDEX IF NOT EXISTS idx_orders_panel_status ON orders(panel_id, status);
CREATE INDEX IF NOT EXISTS idx_orders_username ON orders(marzban_username);
CREATE INDEX IF NOT EXISTS idx_tickets_status ON tickets(status);
CREATE INDEX IF NOT EXISTS idx_tickets_user ON tickets(user_id);
CREATE INDEX IF NOT EXISTS idx_users_banned ON users(banned);
CREATE INDEX IF NOT EXISTS idx_referrals_referrer ON referrals(referrer_id);

-- ุจูููโุณุงุฒ
ANALYZE;
PRAGMA optimize;

-- ุฎุฑูุฌ
.exit
```

#### 3. ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ
```bash
sudo systemctl restart v2bot
```

---

## ุชุณุช ุนููฺฉุฑุฏ

ุจุนุฏ ุงุฒ ุงุนูุงู ุชุบุฑุงุชุ ุงู ููุงุฑุฏ ุฑุง ุชุณุช ฺฉูุฏ:

### โ ุชุณุช 1: ุฏฺฉูู ุฎุงููุด/ุฑูุดู ุฑุจุงุช
1. ูุงุฑุฏ ูพูู ุงุฏูู ุดูุฏ (`/admin`)
2. ุฑู ุฏฺฉูู "๐ข ุฑุจุงุช ุฑูุดู (ุฎุงููุด ฺฉุฑุฏู)" ฺฉูฺฉ ฺฉูุฏ
3. ุจุงุฏ ูุถุนุช ุชุบุฑ ฺฉูุฏ ู ููู refresh ุดูุฏ

### โ ุชุณุช 2: ุณูุงุฑุดุงุช ุฏุฑ ุงูุชุธุงุฑ
1. ุฏุฑ ูพูู ุงุฏููุ ฺฏุฒูู "๐ฆ ุณูุงุฑุดุงุช" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
2. ุฑู "โณ ุณูุงุฑุดุงุช ุฏุฑ ุงูุชุธุงุฑ" ฺฉูฺฉ ฺฉูุฏ
3. ุจุงุฏ ูุณุช ุณูุงุฑุดุงุช pending ููุงุด ุฏุงุฏู ุดูุฏ

### โ ุชุณุช 3: ุงุฏุขูุฑ ูุฑุฏุง
1. ููุชุธุฑ ฺฉ ูพุงู ุงุฏุขูุฑ ุชูุฏุฏ ุจุงุดุฏ (ุง ุจุง ุฏุณุชฺฉุงุฑ ุฏุชุงุจุณ ุชุณุช ฺฉูุฏ)
2. ุฑู ุฏฺฉูู "๐ ุงุฏุขูุฑ ูุฑุฏุง" ฺฉูฺฉ ฺฉูุฏ
3. ุจุงุฏ ูพุงู "ุงุฏุขูุฑ ุจู ูุฑุฏุง ููฺฉูู ุดุฏ" ููุงุด ุฏุงุฏู ุดูุฏ

### โ ุชุณุช 4: ุจฺฉุงูพ
1. ุฏุฑ ุชูุธูุงุช ูพูู ุงุฏููุ ุจฺฉุงูพ ุฎูุฏฺฉุงุฑ ุฑุง ูุนุงู ฺฉูุฏ
2. ุง ุฏุณุช ุจฺฉุงูพ ุงุฌุงุฏ ฺฉูุฏ
3. ูุงู ZIP ุจุงุฏ ุดุงูู ูุงูโูุง JSON ูุชุนุฏุฏ ุจุงุดุฏ

### โ ุชุณุช 5: ุนููฺฉุฑุฏ
```bash
# ุจุฑุฑุณ ุฒูุงู ูพุงุณุฎโุฏู
time python3 -c "from bot.db import query_db; print(query_db('SELECT COUNT(*) FROM orders'))"

# ูุดุงูุฏู ูุงฺฏโูุง
tail -f logs/bot.log  # ุง ูุณุฑ ูุงฺฏ ุดูุง
```

---

## ุฑูุน ูุดฺฉูุงุช ุงุญุชูุงู

### ูุดฺฉู 1: ุฎุทุง ุฏุฑ ุงุฌุงุฏ ุงูุฏฺฉุณ
```
Error: duplicate column name
```

**ุฑุงูโุญู:** ุงูุฏฺฉุณ ุงุฒ ูุจู ูุฌูุฏ ุฏุงุฑุฏ. ูุดฺฉู ูุณุชุ ุงุฏุงูู ุฏูุฏ.

---

### ูุดฺฉู 2: ุฑุจุงุช ุงุณุชุงุฑุช ููโุดูุฏ
```
ModuleNotFoundError: No module named 'telegram'
```

**ุฑุงูโุญู:**
```bash
pip3 install -r requirements.txt --upgrade
```

---

### ูุดฺฉู 3: ุฏุชุงุจุณ ููู ุงุณุช
```
database is locked
```

**ุฑุงูโุญู:**
```bash
# ูุชููู ฺฉุฑุฏู ฺฉุงูู ุฑุจุงุช
sudo systemctl stop v2bot
pkill -f "python.*main.py"

# ุณูพุณ ุฏูุจุงุฑู ุงุณฺฉุฑูพุช ุฑุง ุงุฌุฑุง ฺฉูุฏ
```

---

### ูุดฺฉู 4: handler ุงูุช ูุดุฏ
```
KeyError: 'admin_orders_pending'
```

**ุฑุงูโุญู:**
```bash
# ูุทูุฆู ุดูุฏ ุชูุงู ูุงูโูุง ุจุฑูุฒ ูุณุชูุฏ
git pull  # ุงฺฏุฑ ุงุฒ git ุงุณุชูุงุฏู ูโฺฉูุฏ

# ุง ูุงูโูุง ุชุบุฑ ุงูุชู ุฑุง ุฏุณุช ฺฉูพ ฺฉูุฏ
```

---

### ูุดฺฉู 5: ุนููฺฉุฑุฏ ุจูุจูุฏ ูุงูุช

**ุจุฑุฑุณโูุง ูุงุฒู:**

1. **ุจุฑุฑุณ ุงูุฏฺฉุณโูุง:**
```bash
sqlite3 bot.db "SELECT name FROM sqlite_master WHERE type='index';"
```

2. **ุจุฑุฑุณ ุญุฌู ุฏุชุงุจุณ:**
```bash
ls -lh bot.db
```

ุงฺฏุฑ ุจุด ุงุฒ 500MB ุงุณุชุ vacuum ุงูุฌุงู ุฏูุฏ:
```bash
sqlite3 bot.db "VACUUM;"
```

3. **ุจุฑุฑุณ ููุงุจุน ุณุฑูุฑ:**
```bash
top
free -h
df -h
```

4. **ุจุฑุฑุณ ุณุฑุนุช ูพูู:**
```bash
curl -w "@curl-format.txt" -o /dev/null -s "https://your-panel.com"
```

---

## ูุดุงูุฏู ูุงฺฏโูุง

ุจุฑุง ุจุฑุฑุณ ุนููฺฉุฑุฏ ู ูุดฺฉูุงุช:

```bash
# ูุงฺฏโูุง ุฑุจุงุช
tail -f logs/bot.log

# ูุงฺฏโูุง systemd (ุงฺฏุฑ ุจุง systemd ุงุฌุฑุง ูโฺฉูุฏ)
sudo journalctl -u v2bot -f

# ุฌุณุชุฌู ุฏุฑ ูุงฺฏโูุง
grep "Error" logs/bot.log
grep "admin_toggle_bot_active" logs/bot.log
```

---

## ุจุฑุฑุณ ููุง

ุจุนุฏ ุงุฒ ุงุนูุงู ุชูุงู ุชุบุฑุงุช:

```bash
# 1. ุจุฑุฑุณ ูุถุนุช ุฑุจุงุช
sudo systemctl status v2bot

# 2. ุจุฑุฑุณ ุงูุฏฺฉุณโูุง
python3 apply_performance_fixes.py  # ฺฏุฒูู check ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ

# 3. ุชุณุช ุณุฑุนุช
time python3 -c "
from bot.db import query_db
import time
start = time.time()
query_db('SELECT * FROM orders WHERE status=\\"pending\\"')
print(f'Query time: {time.time()-start:.3f}s')
"
```

---

## ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:

1. **ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ**
2. **ุฏุชุงุจุณ ุฑุง ุจุง integrity check ุจุฑุฑุณ ฺฉูุฏ:**
   ```bash
   sqlite3 bot.db "PRAGMA integrity_check;"
   ```
3. **ุจฺฉุงูพ ุฑุง ุจุงุฒฺฏุฑุฏุงู ฺฉูุฏ:**
   ```bash
   cp bot.db.backup_YYYYMMDD bot.db
   sudo systemctl restart v2bot
   ```

---

## ฺฺฉโูุณุช ููุง

ูุจู ุงุฒ ุฑุงูโุงูุฏุงุฒ ููุง:

- [ ] ุจฺฉุงูพ ุงุฒ ุฏุชุงุจุณ ฺฏุฑูุชู ุดุฏู
- [ ] ุงูุฏฺฉุณโูุง ุฌุฏุฏ ุงุถุงูู ุดุฏู
- [ ] ุชูุงู ูุงูโูุง ุชุบุฑ ุงูุชู ุจุฑูุฒ ุดุฏู
- [ ] ุฑุจุงุช restart ุดุฏู
- [ ] ุชุณุชโูุง ุงุณุงุณ ุงูุฌุงู ุดุฏู
- [ ] ูุงฺฏโูุง ุจุฑุฑุณ ุดุฏู
- [ ] ุนููฺฉุฑุฏ ุจูุจูุฏ ุงูุชู

---

## ุงุทูุงุนุงุช ุจุดุชุฑ

- `CHANGELOG_FIXES.md` - ูุณุช ฺฉุงูู ุชุบุฑุงุช
- `PERFORMANCE_IMPROVEMENTS.md` - ุฑุงูููุง ุจูููโุณุงุฒ ูพุดุฑูุชู
- `README.md` - ูุณุชูุฏุงุช ุงุตู ูพุฑูฺู

---

**ุชุงุฑุฎ:** 27 ุงฺฉุชุจุฑ 2025  
**ูุณุฎู:** 2.0  
**ูุถุนุช:** ุชุณุช ุดุฏู ู ุขูุงุฏู ุงุณุชูุงุฏู
